<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ashfaque Ahmad | PhD Portfolio</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* --- GLOBAL VARIABLES --- */
        :root {
            --primary-color: #ffffff; 
            --accent-color: #4facfe;  
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #f0f0f0;
            margin: 0; padding: 0;
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.95)),
                url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=2000&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, p, span, a, li, th, td { text-shadow: 0 2px 4px rgba(0,0,0,1); }
        h1, h2, h3, h4 { font-weight: 700; color: var(--primary-color); margin-top: 0; }
        a { text-decoration: none; transition: 0.3s; }

        /* --- NAVBAR --- */
        header {
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky; top: 0; z-index: 1000;
            backdrop-filter: blur(5px);
        }
        nav {
            max-width: 1200px; margin: 0 auto; padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .nav-brand { font-weight: 900; color: #fff; font-size: 1.5rem; letter-spacing: 2px; border: 2px solid #fff; padding: 2px 8px; border-radius: 4px; }
        .nav-links a { margin-left: 20px; color: #ccc; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .nav-links a:hover { color: var(--accent-color); }

        /* --- UPPER SECTION --- */
        .hero-section { padding: 3rem 1rem; margin-bottom: 2rem; }
        .hero-container {
            max-width: 1200px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 1.3fr; gap: 4rem; 
            align-items: start;
        }
        @media(max-width: 900px) { .hero-container { grid-template-columns: 1fr; } }

        /* PROFILE SECTION */
        .profile-container { padding: 10px; }
        .photo-circle { 
            width: 110px; height: 110px; background: #111; border: 3px solid var(--accent-color); 
            border-radius: 50%; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; color: #555;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }
        .profile-name { font-size: 2rem; color: #fff; font-weight: 800; margin-bottom: 5px; letter-spacing: 1px; }
        .profile-role { color: var(--accent-color); font-size: 1rem; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 25px; display: block; }
        
        .edu-item { margin-bottom: 15px; border-left: 3px solid var(--accent-color); padding-left: 15px; }
        .edu-degree { color: #fff; font-weight: bold; font-size: 1rem; display: block; }
        .edu-uni { color: #ccc; font-size: 0.9rem; }
        .edu-status { color: #888; font-size: 0.8rem; font-style: italic; }
        
        .skills-header { margin-top: 25px; font-size: 0.9rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .skills-list { display: flex; gap: 8px; flex-wrap: wrap; padding: 0; list-style: none; }
        .skill-tag { background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; }
        
        .contact-btn { display: inline-block; background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); font-weight: bold; padding: 10px 25px; border-radius: 30px; text-decoration: none; margin-top: 30px; transition: 0.3s; cursor: pointer; }
        .contact-btn:hover { background: var(--accent-color); color: #000; box-shadow: 0 0 20px var(--accent-color); }

        /* GAME CONTAINER */
        .hero-game-wrapper {
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;
        }
        .physics-explainer { margin-top: 15px; font-size: 0.9rem; color: #ccc; font-style: italic; }
        .game-canvas-box {
            width: 100%; height: 280px; background: #000; border: 1px solid #333; border-radius: 4px; 
            position: relative; overflow: hidden; margin-bottom: 15px; cursor: crosshair;
        }
        .game-controls-compact { display: flex; gap: 15px; justify-content: space-between; align-items: center; }
        .game-panel { flex: 1; }
        .game-panel h4 { margin: 0 0 5px 0; font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase; color: #aaa; }
        .g-btn { background: #222; color: #aaa; border: 1px solid #444; padding: 4px 8px; cursor: pointer; font-size: 0.75rem; font-weight: bold; border-radius: 4px; transition: 0.2s; }
        .g-btn:hover { background: #333; }
        .g-btn.active { background: var(--accent-color); color: #000; border-color: var(--accent-color); }
        .g-btn.active-red { background: #ff4444; color: #000; border-color: #ff4444; }
        .fire-btn-small { width: 100%; background: #238636; color: #fff; padding: 10px; border: none; font-weight: bold; margin-top: 15px; font-size: 0.9rem; border-radius: 4px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .fire-btn-small:hover { background: #2ea043; }

        /* --- LOWER SECTION --- */
        .page-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        @media(max-width: 900px) { .page-wrapper { grid-template-columns: 1fr; } }
        .content-section { margin-bottom: 30px; }
        .section-header { font-size: 1.2rem; color: var(--accent-color); border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; }

        /* DASHBOARD GRID */
        .dashboard-list { list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .dash-item { 
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; 
            text-align: center; cursor: pointer; border: 1px solid transparent; transition: 0.2s;
        }
        .dash-item:hover { background: rgba(255,255,255,0.1); border-color: var(--accent-color); transform: translateY(-3px); }
        .dash-icon { font-size: 2rem; display: block; margin-bottom: 10px; }
        .dash-text h4 { margin: 0; font-size: 0.9rem; color: #fff; }
        
        /* DASHBOARD VIEWER */
        #dashboard-viewer {
            margin-top: 20px; background: rgba(0,0,0,0.8); border: 1px solid var(--accent-color); 
            padding: 20px; border-radius: 8px; display: none; 
        }
        .viewer-title { color: var(--accent-color); margin-top: 0; border-bottom: 1px dashed #444; padding-bottom: 10px; margin-bottom: 15px; }
        .close-viewer { float: right; cursor: pointer; color: #ff4444; font-weight: bold; font-size: 1.5rem; line-height: 0.8; }
        
        /* TABLE STYLES */
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; color: #ccc; }
        .data-table th { text-align: left; border-bottom: 1px solid #555; padding: 8px; color: #fff; text-transform: uppercase; font-size: 0.75rem; }
        .data-table td { padding: 8px; border-bottom: 1px solid #333; }
        .data-table tr:hover { background: rgba(255,255,255,0.05); }
        .dl-btn { background: #333; color: var(--accent-color); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; text-decoration: none; }
        .dl-btn:hover { background: var(--accent-color); color: #000; }

        /* UPDATES */
        .update-item { margin-bottom: 25px; position: relative; padding-left: 20px; border-left: 2px solid #333; }
        .update-item:hover { border-left-color: var(--accent-color); }
        .update-date { color: var(--accent-color); font-weight: bold; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .update-content h4 { font-size: 1.1rem; margin-bottom: 5px; color: #eee; }
        .update-content p { font-size: 0.9rem; color: #ccc; margin-bottom: 5px; }
        .source-link { font-size: 0.8rem; color: #666; font-style: italic; }
        .source-link:hover { color: #fff; text-decoration: underline; }

        /* --- CONTACT MODAL --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: rgba(20, 25, 40, 0.95); border: 1px solid var(--accent-color);
            padding: 30px; border-radius: 12px; width: 90%; max-width: 350px; text-align: center;
            position: relative; box-shadow: 0 0 30px rgba(79, 172, 254, 0.3);
            animation: zoomIn 0.3s ease;
        }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; color: #888; cursor: pointer; }
        .modal-close:hover { color: #fff; }
        
        .contact-option {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background: rgba(255,255,255,0.08); color: #fff; text-decoration: none;
            padding: 12px; margin: 12px 0; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);
            transition: 0.2s; font-weight: bold; font-size: 0.9rem;
        }
        .contact-option:hover { background: var(--accent-color); color: #000; border-color: var(--accent-color); }

        footer { text-align: center; padding: 3rem; color: #555; font-size: 0.8rem; margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>

    <header>
        <nav>
            <div class="nav-brand">AA</div>
            <div class="nav-links">
                <a href="#about">Profile</a>
                <a href="#dashboard">Dashboard</a>
                <a href="#updates">Updates</a>
            </div>
        </nav>
    </header>
    
    <section class="hero-section">
        <div class="hero-container">
            <div class="profile-container" id="about">
                <div class="photo-circle">Photo</div>
                <div class="profile-name">Ashfaque Ahmad</div>
                <span class="profile-role">High Energy Physics Scholar</span>
                
                <p style="color: #ddd; font-size: 0.95rem; line-height: 1.6;">
                    <p style="color: #ddd; font-size: 0.95rem; line-height: 1.6;">
    I am a researcher specializing in <strong>Theoretical High Energy Physics</strong>. My work investigates the formation and decay of <strong>microscopic black holes</strong> in extra spatial dimensions, searching for physics beyond the Standard Model. 
</p>
                </p>

                <div style="margin-top: 30px;">
                    <div class="edu-item">
                        <span class="edu-degree">PhD High Energy Physics</span>
                        <span class="edu-uni">Aligarh Muslim University (Pursuing)</span>
                    </div>
                    <div class="edu-item">
                        <span class="edu-degree">Post Dip. Geoinformatics</span>
                        <span class="edu-uni">Jamia Millia Islamia (Completed)</span>
                    </div>
                </div>
                <div class="skills-header">Technical Skills</div>
                <div class="skills-list">
                    <span class="skill-tag">C++</span><span class="skill-tag">Python</span>
                    <span class="skill-tag">ArcGIS</span><span class="skill-tag">LaTeX</span><span class="skill-tag">Linux</span>
                </div>
                
                <button class="contact-btn" onclick="openContactModal()">Contact Me</button>
            </div>

            <div class="hero-game-wrapper">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <div id="particleSelect" style="display:flex; gap:2px;">
                        <button class="g-btn active" onclick="game.setParticle('proton', this)">p+</button>
                        <button class="g-btn" onclick="game.setParticle('electron', this)">e-</button>
                        <button class="g-btn" onclick="game.setParticle('alpha', this)">Î±</button>
                    </div>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span style="font-size:0.7rem; color:#aaa;">ANGLE</span>
                        <input type="range" id="angleSlide" min="-45" max="45" value="0" style="width: 60px;">
                    </div>
                </div>
                <div class="game-canvas-box">
                    <canvas id="simCanvas"></canvas>
                    <div style="position:absolute; top:5px; right:10px; font-weight:bold; color:#0f0; font-size:1rem;">Hits: <span id="score">0</span></div>
                    <div style="position:absolute; bottom:5px; left:10px; font-size:0.7rem; color:#888;">
                        <span id="pType" style="color:#fff">Proton</span> (q=<span id="pCharge">+1</span>)
                    </div>
                </div>
                <div class="game-controls-compact">
                    <div class="game-panel">
                        <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                            <h4 style="color:#ff4444">E-FIELD</h4>
                            <button class="g-btn" id="btnE" onclick="game.toggle('E')">OFF</button>
                        </div>
                        <div style="display:flex; gap:2px; margin-bottom:2px;">
                            <button class="g-btn" style="flex:1" onclick="game.setDir('E', 1)">UP</button>
                            <button class="g-btn" style="flex:1" onclick="game.setDir('E', -1)">DWN</button>
                        </div>
                        <input type="range" id="slideE" min="0" max="100" value="50" style="width:100%; height:4px;">
                    </div>
                    <div class="game-panel">
                        <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                            <h4 style="color:#4facfe">B-FIELD</h4>
                            <button class="g-btn" id="btnB" onclick="game.toggle('B')">OFF</button>
                        </div>
                        <div style="display:flex; gap:2px; margin-bottom:2px;">
                            <button class="g-btn" style="flex:1" onclick="game.setDir('B', 1)">IN</button>
                            <button class="g-btn" style="flex:1" onclick="game.setDir('B', -1)">OUT</button>
                        </div>
                        <input type="range" id="slideB" min="0" max="100" value="50" style="width:100%; height:4px;">
                    </div>
                </div>
                <button class="fire-btn-small" onclick="game.fire()">FIRE BEAM</button>
                <div class="physics-explainer">
  
                    Use fields to guide the particle to the <span style="color:#0f0">Green Target</span>.
                </div>
            </div>
        </div>
    </section>

    <div class="page-wrapper">
        
        <div class="content-section" id="dashboard">
            <h3 class="section-header">Academic Dashboard</h3>
            <div class="dashboard-list">
                <div class="dash-item" onclick="openViewer('papers')">
                    <div class="dash-icon">ðŸ“„</div>
                    <div class="dash-text"><h4>Research Papers</h4></div>
                </div>
                <div class="dash-item" onclick="openViewer('notes')">
                    <div class="dash-icon">ðŸ““</div>
                    <div class="dash-text"><h4>Lecture Notes</h4></div>
                </div>
                <div class="dash-item" onclick="openViewer('projects')">
                    <div class="dash-icon">ðŸŽ“</div>
                    <div class="dash-text"><h4>Student Projects</h4></div>
                </div>
            </div>

            <div id="dashboard-viewer">
                <span class="close-viewer" onclick="closeViewer()">&times;</span>
                <h3 class="viewer-title" id="viewer-heading">Details</h3>
                <div id="viewer-content"></div>
            </div>
        </div>

        <div class="content-section" id="updates">
            <h3 class="section-header">Global Updates</h3>
            <div class="update-item">
                <span class="update-date">LHC RUN 3</span>
                <div class="update-content">
                    <h4>Record Energy Levels</h4>
                    <p>CERN's Large Hadron Collider begins Run 3 at 13.6 TeV.</p>
                    <a href="https://home.cern/news/news/accelerators/large-hadron-collider-restarts" target="_blank" class="source-link">Source: CERN â†—</a>
                </div>
            </div>
            <div class="update-item">
                <span class="update-date">GRAVITY</span>
                <div class="update-content">
                    <h4>Background Waves Detected</h4>
                    <p>NANOGrav reports evidence of low-frequency gravitational waves.</p>
                    <a href="https://nanograv.org/news" target="_blank" class="source-link">Source: NANOGrav â†—</a>
                </div>
            </div>
            <div class="update-item">
                <span class="update-date">COSMOLOGY</span>
                <div class="update-content">
                    <h4>Dark Energy Survey</h4>
                    <p>Newest map places tighter constraints on Dark Energy parameters.</p>
                    <a href="https://www.darkenergysurvey.org/" target="_blank" class="source-link">Source: DES â†—</a>
                </div>
            </div>
        </div>

    </div>

    <footer>&copy; 2026 Ashfaque Ahmad. Aligarh Muslim University.</footer>

    <div id="contact-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" onclick="closeContactModal()">&times;</span>
            <h3 style="margin-top:0; color:#fff;">Connect with Me</h3>
            <p style="font-size:0.85rem; color:#aaa; margin-bottom:20px;">Choose a method to get in touch.</p>
            
            <a href="mailto:ashfaque.phy@gmail.com" class="contact-option">
                ðŸ“§ Send Email
            </a>
            
            <a href="https://instagram.com/your_instagram_id" target="_blank" class="contact-option">
                ðŸ“¸ Instagram
            </a>
            
            <a href="mailto:ashfaque.phy@gmail.com?subject=Request%20Mobile%20Number" class="contact-option">
                ðŸ“± Request Mobile No
            </a>
        </div>
    </div>

    <script>
        // --- CONTACT MODAL LOGIC ---
        function openContactModal() {
            document.getElementById('contact-modal').style.display = 'flex';
        }
        function closeContactModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }
        // Close if clicked outside
        window.onclick = function(event) {
            if (event.target == document.getElementById('contact-modal')) {
                closeContactModal();
            }
        }

        // --- DASHBOARD DATA & LOGIC ---
        const dashboardData = {
            papers: [
                { title: "....", dl: "#" },
                { title: "...", dl: "#" },
                { title: "...", dl: "#" }
            ],
            notes: [
                { topic: "....", dl: "#" },
                { topic: "...", dl: "#" },
                { topic: "....", dl: "#" }
            ],
            projects: [
                { 
                    name: "Saiba Noor", 
                    topic: "The Evolution of Indian English Poetry: From Toru Dutt to Kamala Das", 
                    course: "B.A. English", 
                    enroll: "2400105402", 
                    uni: "Integral University, Lucknow", 
                    year: "2025", 
                    dl: "files/saiba_project.pdf" 
                },
                { 
                    name: "Zeenat Islam", 
                    topic: "Charles Dickens â€“ Great Expectations (Class, ambition, identity)", 
                    course: "B.A. English", 
                    enroll: "2400100686", 
                    uni: "Integral University, Lucknow", 
                    year: "2025", 
                    dl: "files/zeenat_project.pdf" 
                }
            ]
        };

        function openViewer(type) {
            const viewer = document.getElementById('dashboard-viewer');
            const heading = document.getElementById('viewer-heading');
            const content = document.getElementById('viewer-content');
            
            let html = "";
            
            if(type === 'papers') {
                heading.innerText = "Research Papers";
                html = `<table class="data-table"><thead><tr><th>Paper Title</th><th>Action</th></tr></thead><tbody>`;
                dashboardData.papers.forEach(p => {
                    html += `<tr><td>${p.title}</td><td><a href="${p.dl}" class="dl-btn">Download PDF</a></td></tr>`;
                });
                html += `</tbody></table>`;
            }
            else if(type === 'notes') {
                heading.innerText = "Lecture Notes";
                html = `<table class="data-table"><thead><tr><th>Topic</th><th>Action</th></tr></thead><tbody>`;
                dashboardData.notes.forEach(n => {
                    html += `<tr><td>${n.topic}</td><td><a href="${n.dl}" class="dl-btn">Download</a></td></tr>`;
                });
                html += `</tbody></table>`;
            }
            else if(type === 'projects') {
                heading.innerText = "Student Projects";
                html = `<table class="data-table"><thead><tr><th>Name</th><th>Topic</th><th>Course</th><th>Univ</th><th>Year</th><th>Action</th></tr></thead><tbody>`;
                dashboardData.projects.forEach(p => {
                    html += `<tr><td>${p.name}</td><td>${p.topic}</td><td>${p.course}</td><td>${p.uni}</td><td>${p.year}</td><td><a href="${p.dl}" class="dl-btn">Download</a></td></tr>`;
                });
                html += `</tbody></table>`;
            }

            content.innerHTML = html;
            viewer.style.display = "block";
            if(window.innerWidth < 800) viewer.scrollIntoView({behavior: "smooth"});
        }

        function closeViewer() {
            document.getElementById('dashboard-viewer').style.display = "none";
        }

        // --- GAME LOGIC ---
        class ParticleGame {
            constructor() {
                this.canvas = document.getElementById('simCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.explosions = [];
                this.target = {x:0, y:0, r:15};
                this.score = 0;
                this.width = 0; this.height = 0;
                this.pType = 'proton';
                this.activeE = false; this.activeB = false;
                this.dirE = 1; this.dirB = 1; 
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.loop();
            }
            resize() {
                this.width = this.canvas.parentElement.offsetWidth;
                this.height = this.canvas.parentElement.offsetHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
                this.resetTarget();
            }
            resetTarget() {
                this.target.x = this.width * 0.6 + Math.random() * (this.width * 0.3);
                this.target.y = this.height * 0.2 + Math.random() * (this.height * 0.6);
            }
            toggle(field) {
                if(field === 'E') {
                    this.activeE = !this.activeE;
                    document.getElementById('btnE').innerText = this.activeE ? "ON" : "OFF";
                    document.getElementById('btnE').className = this.activeE ? "g-btn active-red" : "g-btn";
                } else {
                    this.activeB = !this.activeB;
                    document.getElementById('btnB').innerText = this.activeB ? "ON" : "OFF";
                    document.getElementById('btnB').className = this.activeB ? "g-btn active" : "g-btn";
                }
            }
            setDir(field, dir) {
                if(field === 'E') { this.dirE = dir; if(!this.activeE) this.toggle('E'); }
                else { this.dirB = dir; if(!this.activeB) this.toggle('B'); }
            }
            setParticle(type, btn) {
                this.pType = type;
                let btns = document.getElementById('particleSelect').children;
                for(let b of btns) b.className = "g-btn";
                btn.className = "g-btn active";
                let q = "+1";
                if(type === 'electron') q = "-1";
                if(type === 'alpha') q = "+2";
                document.getElementById('pType').innerText = type.charAt(0).toUpperCase() + type.slice(1);
                document.getElementById('pCharge').innerText = q;
            }
            fire() {
                const angle = parseInt(document.getElementById('angleSlide').value);
                const rad = (angle * Math.PI) / 180;
                const speed = 4;
                let p = { x: 30, y: this.height/2, vx: Math.cos(rad) * speed, vy: Math.sin(rad) * speed, trail: [], alive: true };
                if(this.pType === 'proton') { p.m=2; p.q=1; p.color="#4facfe"; }
                else if(this.pType === 'electron') { p.m=0.5; p.q=-1; p.color="#ffe600"; }
                else if(this.pType === 'alpha') { p.m=8; p.q=2; p.color="#ff4444"; }
                this.particles.push(p);
            }
            update() {
                const rawE = parseInt(document.getElementById('slideE').value);
                const rawB = parseInt(document.getElementById('slideB').value);
                const valE = this.activeE ? rawE : 0;
                const valB = this.activeB ? rawB : 0;
                for(let i=this.particles.length-1; i>=0; i--) {
                    let p = this.particles[i];
                    const forceY = p.q * valE * 0.03 * -this.dirE;
                    p.vy += forceY / p.m;
                    const omega = (p.q * valB * this.dirB * 0.05) / p.m;
                    if(Math.abs(omega) > 0.001) {
                         const speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                         const angle = Math.atan2(p.vy, p.vx) + omega * 0.1;
                         p.vx = Math.cos(angle) * speed;
                         p.vy = Math.sin(angle) * speed;
                    }
                    const s = 4 + Math.abs(p.vy * 0.5);
                    const curS = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                    if(curS>0) { p.vx=(p.vx/curS)*s; p.vy=(p.vy/curS)*s; }
                    p.x += p.vx; p.y += p.vy;
                    p.trail.push({x:p.x, y:p.y});
                    if(p.trail.length > 40) p.trail.shift();
                    const dx = p.x - this.target.x;
                    const dy = p.y - this.target.y;
                    if(Math.sqrt(dx*dx + dy*dy) < this.target.r + 5) {
                        p.alive = false;
                        this.score++;
                        document.getElementById('score').innerText = this.score;
                        this.explosions.push({x:p.x, y:p.y, r:0, a:1, c:p.color});
                        this.resetTarget();
                    }
                    if(p.x < 0 || p.x > this.width || p.y < 0 || p.y > this.height) p.alive = false;
                    if(!p.alive) this.particles.splice(i, 1);
                }
                for(let i=this.explosions.length-1; i>=0; i--) {
                    let e = this.explosions[i];
                    e.r+=2; e.a-=0.05;
                    if(e.a<=0) this.explosions.splice(i,1);
                }
            }
            draw() {
                this.ctx.fillStyle = "#000"; this.ctx.fillRect(0,0,this.width,this.height);
                this.ctx.strokeStyle="#111"; this.ctx.lineWidth=1;
                for(let x=0; x<this.width; x+=30) { this.ctx.beginPath(); this.ctx.moveTo(x,0); this.ctx.lineTo(x,this.height); this.ctx.stroke(); }
                if(this.activeE) {
                    this.ctx.fillStyle = `rgba(255,50,50,${document.getElementById('slideE').value/200})`;
                    for(let x=30; x<this.width; x+=60) for(let y=30; y<this.height; y+=60) this.drawArrow(x,y, this.dirE);
                }
                if(this.activeB) {
                    this.ctx.fillStyle = `rgba(79,172,254,${document.getElementById('slideB').value/100})`;
                    this.ctx.font="16px Arial";
                    const s = this.dirB===1 ? "Ã—":"â€¢";
                    for(let x=60; x<this.width; x+=60) for(let y=60; y<this.height; y+=60) this.ctx.fillText(s,x,y);
                }
                const angle = parseInt(document.getElementById('angleSlide').value) * Math.PI/180;
                this.ctx.save(); this.ctx.translate(15, this.height/2); this.ctx.rotate(angle);
                this.ctx.fillStyle="#444"; this.ctx.fillRect(0,-6,25,12);
                this.ctx.restore();
                this.ctx.beginPath(); this.ctx.arc(this.target.x, this.target.y, this.target.r, 0, Math.PI*2);
                this.ctx.fillStyle="rgba(0,255,0,0.2)"; this.ctx.fill();
                this.ctx.strokeStyle="#0f0"; this.ctx.stroke();
                for(let p of this.particles) {
                    this.ctx.beginPath(); this.ctx.strokeStyle=p.color; this.ctx.lineWidth=2;
                    if(p.trail.length) { this.ctx.moveTo(p.trail[0].x, p.trail[0].y); for(let t of p.trail) this.ctx.lineTo(t.x, t.y); }
                    this.ctx.stroke();
                    this.ctx.beginPath(); this.ctx.fillStyle="#fff"; this.ctx.arc(p.x, p.y, 3, 0, Math.PI*2); this.ctx.fill();
                }
                for(let e of this.explosions) {
                    this.ctx.beginPath(); this.ctx.strokeStyle=e.c; this.ctx.globalAlpha=e.a; 
                    this.ctx.lineWidth=2; this.ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); this.ctx.stroke(); this.ctx.globalAlpha=1;
                }
            }
            drawArrow(x, y, dir) {
                const d = dir === 1 ? -1 : 1; 
                this.ctx.beginPath(); this.ctx.moveTo(x, y+8*d); this.ctx.lineTo(x, y-8*d);
                this.ctx.lineTo(x-3, y-4*d); this.ctx.moveTo(x, y-8*d); this.ctx.lineTo(x+3, y-4*d);
                this.ctx.strokeStyle = `rgba(255,50,50,0.3)`; this.ctx.stroke();
            }
            loop() {
                this.update(); this.draw(); requestAnimationFrame(() => this.loop());
            }
        }
        const game = new ParticleGame();
    </script>
</body>
</html>
